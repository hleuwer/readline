# Module name
MODULE = readline

# Current Version 
VERSION=1.0.1

# Objects
OBJS = lreadline.o

# System: expands to Msys, Cygwin or GNU/Linux
SYSTEM = $(shell uname -o)

# Lua Version to use:
LV = 5.1
LX = 51

# ====================================================== 
# You probably do not need to change anything below 
#

# Lua Installation path
ifneq (, $(findstring Msys, $(SYSTEM)))
  LUA = c:/usr/local
else
  LUA = /usr/local
endif

# Root of Lua Installation
ifneq (, $(findstring Msys, $(SYSTEM)))
  INSTALL_ROOT=c:/usr/local
else
  INSTALL_ROOT=/usr/local
endif
INSTALL_SHARE=$(INSTALL_ROOT)/share/lua/$(LV)
INSTALL_LIB=$(INSTALL_ROOT)/lib/lua/$(LV)

# Lua specifics
LUAINC=$(LUA)/include
LUABIN=$(LUA)/bin/lua
LUALIB=$(LUA)/lib
TESTLUA=test/test.lua

# Platform specific differences
ifneq (, $(finstring Linux, $(SYSTEM)))
  X := so
  LIBS=
else
  X := dll
  LIBS=-llua$(LX)
endif

# Targets
TARGET_SO=$(MODULE).$X

# Compiler and Linker
ifneq (, $(findstring Msys, $(SYSTEM)))
  SYSINC = c:/usr/include
else
  SYSINC = /usr/include
endif
DEF=-DCOMPATH_H -DVERSION='"$(VERSION)"'
CC=gcc
CFLAGS=-I$(LUAINC) -I$(SYSINC) $(DEF) -Wall -O2 -fPIC
#CFLAGS=-I$(LUAINC) -I$(SYSINC) $(DEF) -Wall -ggdb
LD=gcc
LDFLAGS= -O2 -shared -fPIC
LIBS+= -lreadline -lhistory

# Distribution stuff
DISTNAME=$(MODULE)-$(VERSION)
ifneq (, $(findstring Msys, $(SYSTEM)))
  EXPORTDIR=m:/exports
  DISTARCH=$(DISTNAME).zip
else
  EXPORTDIR=$(HOME)/exports
  DISTARCH=$(DISTNAME).tar.gz
endif
